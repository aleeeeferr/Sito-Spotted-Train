<!doctype html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tariffe EAV</title>
  <link rel="stylesheet" href="../css/static.css" />
  <link rel="stylesheet" href="../css/style.css" />
  <script src="../js/nav-links.js" defer></script>
</head>
<body class="app-body">
  <nav class="topbar">
    <div class="container d-flex align-items-center justify-content-between gap-3">
      <a class="brand" href="/index.html"><span class="dot"></span>EAV Treni</a>
      <div class="nav-links d-none d-md-flex">
        <a href="/index.html">Ricerca orari</a>
        <a href="/pages/tracking.html">Tracking live</a>
        <a href="/pages/mappa.html">Mappa linee</a>
        <a href="/pages/acquista.html">Biglietti</a>
        <a href="/pages/avvisi.html">Avvisi</a>
      </div>
      <div class="nav-actions d-flex align-items-center gap-2">
        <span class="pill pill-soft">Dati live</span>
        <a class="btn btn-sm btn-outline-light" href="/pages/utente.html">Area utente</a>
      </div>
    </div>
  </nav>

  <main class="container page-shell py-4 py-md-5 static-container">
    <section class="page-hero-card mb-4 d-flex justify-content-between align-items-center flex-wrap gap-3">
      <div>
        <p class="eyebrow mb-1">Tariffe</p>
        <h1 class="h4 mb-1">Panoramica prezzi</h1>
        <p class="muted mb-0">Stile allineato alle altre pagine, con importi di riferimento aggiornati.</p>
        <div class="d-flex align-items-center gap-2 flex-wrap mt-2">
          <span class="pill-contrast is-ghost">Tabella TARIFFS</span>
          <span class="pill-contrast is-ghost">Ricerca istantanea</span>
        </div>
        <div class="list-soft mt-2">
          <div class="item">
            <span class="meta-chip text-muted">Fonte</span>
            <span class="small text-muted">Tabella static disponibile in frontend/js/tariffs.js.</span>
          </div>
          <div class="item">
            <span class="meta-chip text-muted">Ricerca</span>
            <span class="small text-muted">Digita parte del codice per filtrare subito la lista.</span>
          </div>
        </div>
      </div>
      <div class="hero-kpis">
        <div class="hero-kpi">
          <small>Titoli</small>
          <strong>Biglietti</strong>
          <div class="muted small">Importi di riferimento</div>
        </div>
        <div class="hero-kpi">
          <small>Abbonamenti</small>
          <strong>Inclusi</strong>
          <div class="muted small">Per ogni codice</div>
        </div>
      </div>
    </section>

    <section class="static-card">
      <div class="tariff-toolbar mb-2">
        <div>
          <p class="eyebrow mb-1">Catalogo tariffe</p>
          <h3 class="h5 mb-1">Ricerca rapida</h3>
          <p class="section-subtitle">Digita il codice (es. U1, AC1) o una parte del nome.</p>
        </div>
        <div class="d-flex align-items-center gap-2 flex-wrap">
          <input id="tariff-search" class="form-control input-glow" type="search" placeholder="Cerca codice tariffa">
          <span class="pill pill-soft" id="tariff-count">0 tariffe</span>
        </div>
      </div>
      <p class="tariff-note mb-3">Questi importi vengono aggiornati dal Consorzio Unico Campania. Li riportiamo come riferimento rapido: trova il codice e scegli il titolo più adatto.</p>
      <div id="tariff-list" class="tariff-list"></div>
    </section>

  </main>

  <script type="module">
    import { TARIFFS } from "../js/tariffs.js";

    const listEl = document.getElementById("tariff-list");
    const countEl = document.getElementById("tariff-count");
    const searchEl = document.getElementById("tariff-search");

    function renderTariffs(filter = "") {
      const entries = Object.entries(TARIFFS)
        .filter(([code]) => code.toLowerCase().includes(filter.toLowerCase().trim()))
        .sort(([a], [b]) => a.localeCompare(b, "it", { sensitivity: "base" }));

      if (countEl) countEl.textContent = `${entries.length} tariffe`;
      if (!listEl) return;

      if (!entries.length) {
        listEl.innerHTML = '<div class="alert alert-secondary mb-0">Nessuna tariffa trovata.</div>';
        return;
      }

      listEl.innerHTML = entries
        .map(([code, data]) => {
          const tickets = data.tickets || {};
          const subs = data.abbonamenti || {};
          return `
            <div class="tariff-card">
              <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
                <div>
                  <div class="train-title mb-1">${code}</div>
                  <div class="text-muted small">Tipo: ${data.tipo || "-"}</div>
                </div>
                <span class="pill pill-soft pill-compact">${data.label || "Tariffa"}</span>
              </div>
              <div class="tariff-grid mt-2">
                <div>
                  <div class="tariff-heading">Biglietti</div>
                  ${renderTicketList(tickets)}
                </div>
                <div>
                  <div class="tariff-heading">Abbonamenti</div>
                  ${renderTicketList(subs)}
                </div>
              </div>
            </div>
          `;
        })
        .join("");
    }

    function renderTicketList(group) {
      const items = Object.entries(group || {});
      if (!items.length) return '<div class="muted small">Nessun dato</div>';
      return `<ul class="tariff-ul">
        ${items
          .map(
            ([key, val]) => `
              <li>
                <div class="fw-semibold">${val.label || key}</div>
                <div class="text-muted small">
                  Aziendale: ${val.aziendale ?? "-"} · Integrato: ${val.integrato ?? "-"}
                </div>
              </li>
            `
          )
          .join("")}
      </ul>`;
    }

    searchEl?.addEventListener("input", (e) => {
      renderTariffs(e.target.value || "");
    });

    renderTariffs();
  </script>
</body>
</html>
