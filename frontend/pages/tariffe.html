<!doctype html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tariffe EAV</title>
  <link rel="stylesheet" href="../css/static.css" />
  <link rel="stylesheet" href="../css/style.css" />
</head>
<body class="app-body">
  <nav class="topbar">
    <div class="container d-flex align-items-center justify-content-between gap-3">
      <a class="brand" href="/index.html"><span class="dot"></span>EAV Treni</a>
      <div class="nav-links d-none d-md-flex">
        <a href="/index.html">Ricerca orari</a>
        <a href="/pages/tracking.html">Tracking live</a>
        <a href="/pages/acquista.html">Biglietti</a>
        <a href="/pages/avvisi.html">Avvisi</a>
      </div>
      <div class="nav-actions d-flex align-items-center gap-2">
        <span class="pill pill-soft">Dati live</span>
        <a class="btn btn-sm btn-outline-light" href="/pages/utente.html">Area utente</a>
      </div>
    </div>
  </nav>

  <main class="container page-shell py-4 py-md-5 static-container">
    <section class="page-hero-card mb-4 d-flex justify-content-between align-items-center flex-wrap gap-3">
      <div>
        <p class="eyebrow mb-1">Tariffe</p>
        <h1 class="h4 mb-1">Panoramica prezzi</h1>
        <p class="muted mb-0">Stile allineato alle altre pagine, con importi di riferimento aggiornati.</p>
      </div>
      <span class="pill pill-ghost">Statico</span>
    </section>

    <section class="tariffe-static">
      <header class="tariffe-static-header">
        <h3>Titoli disponibili</h3>
        <p>
          Questi importi vengono aggiornati direttamente dal Consorzio Unico Campania. Li riportiamo qui come riferimento rapido,
          proprio come nella pagina ufficiale: scegli il titolo più adatto dopo aver ricavato la sigla tariffaria con il form qui sopra.
        </p>
      </header>

  <script type="module">
    import { TARIFFS } from "../js/tariffs.js";

    const listEl = document.getElementById("tariff-list");
    const countEl = document.getElementById("tariff-count");
    const searchEl = document.getElementById("tariff-search");

    function renderTariffs(filter = "") {
      const entries = Object.entries(TARIFFS)
        .filter(([code]) => code.toLowerCase().includes(filter.toLowerCase().trim()))
        .sort(([a], [b]) => a.localeCompare(b, "it", { sensitivity: "base" }));

      if (countEl) countEl.textContent = `${entries.length} tariffe`;
      if (!listEl) return;

      if (!entries.length) {
        listEl.innerHTML = '<div class="alert alert-secondary mb-0">Nessuna tariffa trovata.</div>';
        return;
      }

      listEl.innerHTML = entries
        .map(([code, data]) => {
          const tickets = data.tickets || {};
          const subs = data.abbonamenti || {};
          return `
            <div class="tariff-card">
              <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
                <div>
                  <div class="train-title mb-1">${code}</div>
                  <div class="text-muted small">Tipo: ${data.tipo || "-"}</div>
                </div>
                <span class="pill pill-soft pill-compact">${data.label || "Tariffa"}</span>
              </div>
              <div class="tariff-grid mt-2">
                <div>
                  <div class="tariff-heading">Biglietti</div>
                  ${renderTicketList(tickets)}
                </div>
                <div>
                  <div class="tariff-heading">Abbonamenti</div>
                  ${renderTicketList(subs)}
                </div>
              </div>
            </div>
          `;
        })
        .join("");
    }

    function renderTicketList(group) {
      const items = Object.entries(group || {});
      if (!items.length) return '<div class="muted small">Nessun dato</div>';
      return `<ul class="tariff-ul">
        ${items
          .map(
            ([key, val]) => `
              <li>
                <div class="fw-semibold">${val.label || key}</div>
                <div class="text-muted small">
                  Aziendale: ${val.aziendale ?? "-"} · Integrato: ${val.integrato ?? "-"}
                </div>
              </li>
            `
          )
          .join("")}
      </ul>`;
    }

    searchEl?.addEventListener("input", (e) => {
      renderTariffs(e.target.value || "");
    });

    renderTariffs();
  </script>
</body>
</html>
