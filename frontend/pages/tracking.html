<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tracking treno</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="../css/style.css" />
    <script src="../js/nav-links.js" defer></script>
  </head>
  <body class="app-body">
    <nav class="topbar">
      <div class="container d-flex align-items-center justify-content-between gap-3">
        <a class="brand" href="/index.html"><span class="dot"></span>EAV Treni</a>
        <div class="nav-links d-none d-md-flex">
        <a href="/index.html">Ricerca orari</a>
        <a class="active" href="/pages/tracking.html">Tracking live</a>
        <a href="/pages/mappa.html">Mappa linee</a>
        <a href="/pages/acquista.html">Biglietti</a>
        <a href="/pages/avvisi.html">Avvisi</a>
      </div>
        <div class="nav-actions d-flex align-items-center gap-2">
          <span class="pill pill-soft">Dati live</span>
          <a class="btn btn-sm btn-outline-light" href="/pages/utente.html">Area utente</a>
        </div>
      </div>
    </nav>
    <main class="container page page-shell pt-3 pb-5">
      <section class="page-hero-card mb-4">
        <div class="row g-3 align-items-center">
          <div class="col-lg-7">
            <p class="eyebrow mb-1">Live network</p>
            <h1 class="h4 mb-1">Tracking in tempo reale</h1>
            <p class="muted mb-2">Segui la corsa, vedi ritardi e binari e passa da una tratta all'altra con un clic.</p>
            <div class="d-flex align-items-center gap-2 flex-wrap mt-2">
              <span class="pill-contrast is-ghost">Aggiornamento ogni 30s</span>
              <span class="pill-contrast is-ghost">Storage proxy attivo</span>
              <span class="pill-contrast is-ghost">App Check pronto</span>
            </div>
            <div class="list-soft mt-2">
              <div class="item">
                <span class="meta-chip text-muted">Manifest</span>
                <span class="small text-muted">manifest.json + station_data.json caricati in apertura.</span>
              </div>
              <div class="item">
                <span class="meta-chip text-muted">Linea</span>
                <span class="small text-muted">Seleziona linea, origine e (opz.) destinazione per filtrare i treni.</span>
              </div>
            </div>
          </div>
          <div class="col-lg-5">
            <div class="hero-kpis mb-2">
              <div class="hero-kpi">
                <small>Stazioni</small>
                <strong>Live</strong>
                <div class="muted small">Percorso aggiornato</div>
              </div>
              <div class="hero-kpi">
                <small>Polling</small>
                <strong>30s</strong>
                <div class="muted small">Aggiornamento automatico</div>
              </div>
              <div class="hero-kpi">
                <small>Proxy</small>
                <strong>Attivo</strong>
                <div class="muted small">Forzato in pagina</div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <section class="row g-4 align-items-stretch hero-block justify-content-center">
        <div class="col-lg-10 col-xl-9">
          <div class="card search-card h-100 shadow-lg">
            <div class="d-flex justify-content-between align-items-start flex-wrap gap-2 mb-3">
              <div>
                <p class="eyebrow mb-1">Tracking live</p>
                <h1 class="h4 mb-1" id="line-title">Linea Napoli Porta Nolana → Sorrento</h1>
                <p class="muted mb-0" id="line-subtitle">Monitoraggio continuo delle fermate principali, aggiornato ogni 30s.</p>
              </div>
              <div class="d-flex align-items-center gap-2 flex-wrap">
                <span class="pill pill-live">Live</span>
                <span class="pill pill-soft">Binari inclusi</span>
              </div>
            </div>

            <div class="row g-3">
              <div class="col-12">
                <label for="line-select" class="form-label fw-semibold small-label">Linea</label>
                <select id="line-select" class="form-select form-select-lg input-glow">
                  <option value="">Seleziona linea</option>
                </select>
              </div>
              <div class="col-md-5">
                <label for="origin-select" class="form-label fw-semibold small-label">Partenza</label>
                <select id="origin-select" class="form-select form-select-lg input-glow">
                  <option value="">(nessuna)</option>
                </select>
              </div>
              <div class="col-md-5 position-relative">
                <div class="d-flex justify-content-between align-items-center">
                  <label for="destination-select" class="form-label fw-semibold small-label">Destinazione (opzionale)</label>
                  <span class="pill pill-soft pill-compact">Filtro</span>
                </div>
                <select id="destination-select" class="form-select form-select-lg input-glow">
                  <option value="">(nessuna)</option>
                </select>
              </div>
              <div class="col-md-2 d-flex align-items-end">
                <button id="clear-selection" type="button" class="btn btn-outline-primary w-100 btn-lg">Azzera</button>
              </div>
            </div>

            <div class="mt-3">
              <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-2">
                <p class="eyebrow mb-0">Scegli il treno</p>
                <button id="open-train-picker" type="button" class="btn btn-outline-primary btn-sm">Apri orari</button>
              </div>
              <div id="train-picker" class="list-group list-group-flush border rounded-3" style="max-height: 240px; overflow-y: auto; display: none;"></div>
              <div id="train-picker-empty" class="text-muted small" style="display:none;">Nessun orario disponibile sulla partenza selezionata.</div>
              <div class="list-soft mt-2">
                <div class="item">
                  <span class="meta-chip text-muted">Suggerimento</span>
                  <span class="small text-muted">Prima scegli la linea, poi partenza e destinazione per un elenco mirato.</span>
                </div>
                <div class="item">
                  <span class="meta-chip text-muted">CORS</span>
                  <span class="small text-muted">window.FORCE_STORAGE_PROXY = true; la pagina forza già il proxy.</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="row g-4 mt-2 justify-content-center">
        <div class="col-lg-10 col-xl-9">
          <div class="card panel h-100">
            <div class="panel-header">
              <div>
                <p class="eyebrow mb-1">Percorso monitorato</p>
                <h3 class="h5 mb-0">Stato live</h3>
                <small class="text-muted">Aggiornamento automatico ogni 30s</small>
              </div>
              <div class="legend text-muted d-none d-md-flex align-items-center gap-2">
                <span><span class="legend-dot bg-success"></span>Passate</span>
                <span><span class="legend-dot bg-warning"></span>Corrente</span>
                <span><span class="legend-dot bg-light"></span>In arrivo</span>
              </div>
            </div>
            <div class="line-panel__rail">
              <div id="line-stops" class="line-stops"></div>
            </div>
            <div class="d-flex d-md-none justify-content-start gap-3 text-muted small legend mt-2">
              <span><span class="legend-dot bg-success"></span>Passate</span>
              <span><span class="legend-dot bg-warning"></span>Corrente</span>
              <span><span class="legend-dot bg-light"></span>In arrivo</span>
            </div>
            <div id="stop-status-list" class="stop-status-list mt-2"></div>
          </div>
        </div>
      </section>
    </main>

    <script>
      // Forza il proxy CORS anche qui (tracking)
      window.FORCE_STORAGE_PROXY = true;
      window.STORAGE_PROXY_BASE = "https://corsproxy.io/?";
    </script>
    <script type="module" src="../js/tracking.js"></script>
  </body>
</html>
